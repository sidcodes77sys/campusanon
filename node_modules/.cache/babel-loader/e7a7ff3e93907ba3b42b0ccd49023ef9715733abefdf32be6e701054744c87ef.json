{"ast":null,"code":"import{createContext,useContext,useEffect,useState}from'react';import{supabase,getProfile,updateLastSeen}from'./supabase';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);export function AuthProvider(_ref){let{children}=_ref;const[session,setSession]=useState(null);const[profile,setProfile]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{// Get initial session\nsupabase.auth.getSession().then(_ref2=>{let{data:{session}}=_ref2;setSession(session);if(session!==null&&session!==void 0&&session.user)loadProfile(session.user.id);else setLoading(false);});// Listen for auth changes\nconst{data:{subscription}}=supabase.auth.onAuthStateChange((_event,session)=>{setSession(session);if(session!==null&&session!==void 0&&session.user)loadProfile(session.user.id);else{setProfile(null);setLoading(false);}});return()=>subscription.unsubscribe();},[]);async function loadProfile(userId){try{const p=await getProfile(userId);setProfile(p);updateLastSeen(userId);}catch(e){console.error('Profile load error:',e);}finally{setLoading(false);}}// Keep last_seen updated every 2 minutes while logged in\nuseEffect(()=>{if(!(session!==null&&session!==void 0&&session.user))return;const interval=setInterval(()=>updateLastSeen(session.user.id),2*60*1000);return()=>clearInterval(interval);},[session]);function refreshProfile(){if(session!==null&&session!==void 0&&session.user)loadProfile(session.user.id);}return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{session,profile,loading,refreshProfile},children:children});}export function useAuth(){return useContext(AuthContext);}","map":{"version":3,"names":["createContext","useContext","useEffect","useState","supabase","getProfile","updateLastSeen","jsx","_jsx","AuthContext","AuthProvider","_ref","children","session","setSession","profile","setProfile","loading","setLoading","auth","getSession","then","_ref2","data","user","loadProfile","id","subscription","onAuthStateChange","_event","unsubscribe","userId","p","e","console","error","interval","setInterval","clearInterval","refreshProfile","Provider","value","useAuth"],"sources":["C:/Work/projects/campusanon/src/lib/AuthContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useState } from 'react';\nimport { supabase, getProfile, updateLastSeen } from './supabase';\n\nconst AuthContext = createContext(null);\n\nexport function AuthProvider({ children }) {\n  const [session, setSession] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Get initial session\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      setSession(session);\n      if (session?.user) loadProfile(session.user.id);\n      else setLoading(false);\n    });\n\n    // Listen for auth changes\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {\n      setSession(session);\n      if (session?.user) loadProfile(session.user.id);\n      else { setProfile(null); setLoading(false); }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  async function loadProfile(userId) {\n    try {\n      const p = await getProfile(userId);\n      setProfile(p);\n      updateLastSeen(userId);\n    } catch (e) {\n      console.error('Profile load error:', e);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Keep last_seen updated every 2 minutes while logged in\n  useEffect(() => {\n    if (!session?.user) return;\n    const interval = setInterval(() => updateLastSeen(session.user.id), 2 * 60 * 1000);\n    return () => clearInterval(interval);\n  }, [session]);\n\n  function refreshProfile() {\n    if (session?.user) loadProfile(session.user.id);\n  }\n\n  return (\n    <AuthContext.Provider value={{ session, profile, loading, refreshProfile }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}