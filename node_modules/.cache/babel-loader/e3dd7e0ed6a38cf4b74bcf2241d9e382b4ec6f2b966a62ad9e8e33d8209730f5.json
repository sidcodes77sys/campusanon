{"ast":null,"code":"var _jsxFileName = \"C:\\\\Work\\\\projects\\\\campusanon\\\\src\\\\lib\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useEffect, useState } from 'react';\nimport { supabase, getProfile, updateLastSeen } from './supabase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [session, setSession] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    // Get initial session\n    supabase.auth.getSession().then(({\n      data: {\n        session\n      }\n    }) => {\n      setSession(session);\n      if (session !== null && session !== void 0 && session.user) loadProfile(session.user.id);else setLoading(false);\n    });\n\n    // Listen for auth changes\n    const {\n      data: {\n        subscription\n      }\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      setSession(session);\n      if (session !== null && session !== void 0 && session.user) loadProfile(session.user.id);else {\n        setProfile(null);\n        setLoading(false);\n      }\n    });\n    return () => subscription.unsubscribe();\n  }, []);\n  async function loadProfile(userId) {\n    try {\n      const p = await getProfile(userId);\n      setProfile(p);\n      updateLastSeen(userId);\n    } catch (e) {\n      console.error('Profile load error:', e);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Keep last_seen updated every 2 minutes while logged in\n  useEffect(() => {\n    if (!(session !== null && session !== void 0 && session.user)) return;\n    const interval = setInterval(() => updateLastSeen(session.user.id), 2 * 60 * 1000);\n    return () => clearInterval(interval);\n  }, [session]);\n  function refreshProfile() {\n    if (session !== null && session !== void 0 && session.user) loadProfile(session.user.id);\n  }\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      session,\n      profile,\n      loading,\n      refreshProfile\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"M1m/PKbBaJJaBm9hkfdVyFe0j4w=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  return useContext(AuthContext);\n}\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useState","supabase","getProfile","updateLastSeen","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","session","setSession","profile","setProfile","loading","setLoading","auth","getSession","then","data","user","loadProfile","id","subscription","onAuthStateChange","_event","unsubscribe","userId","p","e","console","error","interval","setInterval","clearInterval","refreshProfile","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["C:/Work/projects/campusanon/src/lib/AuthContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useState } from 'react';\nimport { supabase, getProfile, updateLastSeen } from './supabase';\n\nconst AuthContext = createContext(null);\n\nexport function AuthProvider({ children }) {\n  const [session, setSession] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Get initial session\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      setSession(session);\n      if (session?.user) loadProfile(session.user.id);\n      else setLoading(false);\n    });\n\n    // Listen for auth changes\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {\n      setSession(session);\n      if (session?.user) loadProfile(session.user.id);\n      else { setProfile(null); setLoading(false); }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  async function loadProfile(userId) {\n    try {\n      const p = await getProfile(userId);\n      setProfile(p);\n      updateLastSeen(userId);\n    } catch (e) {\n      console.error('Profile load error:', e);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Keep last_seen updated every 2 minutes while logged in\n  useEffect(() => {\n    if (!session?.user) return;\n    const interval = setInterval(() => updateLastSeen(session.user.id), 2 * 60 * 1000);\n    return () => clearInterval(interval);\n  }, [session]);\n\n  function refreshProfile() {\n    if (session?.user) loadProfile(session.user.id);\n  }\n\n  return (\n    <AuthContext.Provider value={{ session, profile, loading, refreshProfile }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}